# МОБОД 2022: Рекомендательные Системы. Домашнее задание.
## Данные
Использовал датасет на 815 тыс. сессий, который использовался на семинаре№5.
 
## Модель рекоммендера
Модель полностью повторяет ContextualRanker с семинара№5, за исключением добавления эмбеддинга по уникальному артисту для треков.
Поэтому выход нейросети содержит сумм произведений трех компонент (torch.sum(first_track * track * artist, dim=1)), а не двух (torch.sum(first_track * track, dim=1))
Аналогично и при предсказании учитывались эмбеддинги артистов.

## Имплементация в bootify
Используются треки, полученные из модели рекоммендера, но если время прослушивание трека <= 0.65, то рекомендуем трек из топ100 по популярности. А также добавлены проверки на уже прослушенные трек, чтобы не повторяться.

## A/B эксперимент
В варианте A используется модель CONTEXTUAL, в B - моя. Сэмпл из 10000 сессий, разделение пополам.
Анализ эксперимента можно найти в файле recsys/jupyter/ab_results.ipynb
Картинка: recsys/botify/data/ab_results.png


## Как запускать
1. Скорим ноутбук с моделью: recsys/jupyter/mobod-2022.ipynb (или на каггле: https://www.kaggle.com/code/splav12341/mobod-2022/notebook)
данные для обучения находятся на каггл или взять с 5-го семинара
2. Полученный файл (my_recommendations.json) кладем по адресу botify/data/my_recommendations.json
3. (Стопаем и) Поднимаем контейнер с botify: (docker-compose stop) docker-compose up -d --build
4. Запускаем симулятор: python sim/run.py --episodes 10000 --recommender remote --config config/env.yml --seed 31337
5. Запускаем скрипт, чтобы скопировать логи на кластер: python script/dataclient.py --user mob202203 log2hdfs --cleanup marat_dir_model2
6. На кластере запускаем ноутбук ab_results.ipynb
